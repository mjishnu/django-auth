{% extends 'base/base.html' %}

{% block title %}
  Community Blog | ATG
{% endblock %}

{% block content %}
  <div class="row justify-content-between align-items-end g-3 mb-4">
    <div class="col-lg-8">
      <p class="text-uppercase small text-primary fw-semibold mb-1">Insights & stories</p>
      <h1 class="fw-bold">Community blog</h1>
      <p class="text-muted mb-0">Lorem ipsum dolor sit amet consectetur adipisicing elit. Sed accusantium tenetur eveniet.</p>
    </div>
    <div class="col-lg-4 text-lg-end">
      {% if user.is_authenticated and user.user_type == 'doctor' %}
        <a class="btn btn-outline-primary" href="{% url 'create_blog' %}">+ Write an article</a>
      {% endif %}
    </div>
  </div>

  {% for category in categories %}
    <section class="mb-5">
      <div class="d-flex align-items-center justify-content-between mb-3">
        <h2 class="h4 fw-semibold mb-0">{{ category.name }}</h2>
        <span class="badge bg-primary-subtle text-primary">{{ category.public_posts|length }} articles</span>
      </div>
      {% if category.public_posts %}
        <div class="row g-4">
          {% for post in category.public_posts %}
            <div class="col-md-6 col-lg-4">
              <a href="{% url 'blog_detail' post.pk %}" class="text-decoration-none text-reset d-block h-100">
                <article class="card border-0 shadow-sm h-100 card-raise">
                  {% if post.image %}
                    <img src="{{ post.image.url }}" class="card-img-top" alt="{{ post.title }}" />
                  {% endif %}
                  <div class="card-body d-flex flex-column">
                    <h3 class="h5 fw-semibold mb-2">{{ post.title }}</h3>
                    <p class="text-muted small mb-3">By Dr. {{ post.author.last_name|default:post.author.username }} â€¢ {{ post.created_at|date:"M d, Y" }}</p>
                    <p class="text-muted flex-grow-1">{{ post.summary|truncatewords:15 }}</p>
                    <span class="badge bg-secondary-subtle text-secondary align-self-start mt-2">{{ post.category.name }}</span>
                  </div>
                </article>
              </a>
            </div>
          {% endfor %}
        </div>
      {% else %}
        <div class="alert alert-secondary mb-0">No posts in this category yet. Check back soon!</div>
      {% endif %}
    </section>
  {% empty %}
    <div class="alert alert-info">No blog categories available yet.</div>
  {% endfor %}
{% endblock %}
